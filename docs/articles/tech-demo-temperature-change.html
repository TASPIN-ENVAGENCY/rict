<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tech demo: Temperature change • rict</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tech demo: Temperature change">
<meta property="og:description" content="rict">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rict</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/functional-specification.html">River Invertebrate Classification Tool (RICT) Functional Specification</a>
    </li>
    <li>
      <a href="../articles/tech-demo-temperature-change.html">Tech demo: Temperature change</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/aquaMetrics/rict/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tech-demo-temperature-change_files/header-attrs-2.5/header-attrs.js"></script><link href="tech-demo-temperature-change_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="tech-demo-temperature-change_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tech demo: Temperature change</h1>
                        <h4 class="author">Tim Foster</h4>
            
            <h4 class="date">2021-05-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/aquaMetrics/rict/blob/master/vignettes/tech-demo-temperature-change.Rmd"><code>vignettes/tech-demo-temperature-change.Rmd</code></a></small>
      <div class="hidden name"><code>tech-demo-temperature-change.Rmd</code></div>

    </div>

    
    
<div id="intro" class="section level3">
<h3 class="hasAnchor">
<a href="#intro" class="anchor"></a>Intro</h3>
<p>This is a quick example to demonstrate how the <code>rict</code> package can be used to simulate the affect of temperature changes. You will see how to:</p>
<ol style="list-style-type: decimal">
<li>Update the input dataset</li>
<li>Simulate changes to a predictive variables</li>
<li>Predict and classify simulations</li>
<li>Graph and interpret results</li>
</ol>
</div>
<div id="setup" class="section level3">
<h3 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h3>
<p>If you don’t have R installed on your local machine, try using <a href="https://rstudio.cloud/">Rstudio Cloud</a> website to run R in your web browser - it’s quick and free to sign-up.</p>
<p>Before starting, make sure to have the required packages installed in RStudio. We are going to use <code>tidyverse</code> and <code>rict</code> packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aquaMetrics/rict">rict</a></span><span class="op">)</span></code></pre></div>
<p><strong>NOTE: If these packages fail to load, follow this <a href="https://moderndive.netlify.app/1-3-packages.html">example</a> (replacing <code>ggplot2</code> with <code>tidyverse</code>) <em>and</em> follow this separate <a href="https://github.com/aquaMetrics/rict#install">guide</a> to installing <code>rict</code>.</strong></p>
</div>
<div id="run-predictions" class="section level3">
<h3 class="hasAnchor">
<a href="#run-predictions" class="anchor"></a>Run Predictions</h3>
<p>Use the <code>rict_predict</code> function to calculate a set of predictions. We can make predictions based on the demo input data (<code>demo_observed_values</code>) which is available to use when the <code>rict</code> library is loaded.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rict_predict.html">rict_predict</a></span><span class="op">(</span><span class="va">demo_observed_values</span><span class="op">)</span></code></pre></div>
<p>The <code>predictions</code> output includes biological indices predictions as well as the reference temperature values used in the prediction (<code>MEAN.AIR.TEMP</code> and <code>AIR.TEMP.RANGE</code> columns). Behind the scenes, the Grid Reference is used to find the temperature values from a large file of 1km grid-square temperature values for Great Britain stored in the <code>rict</code> package.</p>
<p><strong>NOTE: The Northern Ireland model doesn’t use temperature as a predictive variable.</strong></p>
</div>
<div id="reference-temperature" class="section level3">
<h3 class="hasAnchor">
<a href="#reference-temperature" class="anchor"></a>Reference Temperature</h3>
<p>Temperature values (mean temp and temp range) are one of a number of variables (slope, altitude etc) used to predict the biological indices. It’s useful to be able to look-up reference temperature values, however, we only want the ‘reference’ temperature values as a starting point from which we can slowly increment the temperature values to simulate temperature increase.</p>
<p>To do this, we can include the temperature values as optional columns in our demo input dataset. Usually, we don’t provide these columns as we want <code>rict</code> to look-up these values, but if we do provide these columns, <code>rict</code> will base the indices predictions on the temperature values we provide.</p>
<p>Here we add the <code>MEAN.AIR.TEMP</code> and <code>AIR.TEMP.RANGE</code> reference values from our predictions output into our demo input dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">demo_observed_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="fu">rict</span><span class="fu">::</span><span class="va"><a href="../reference/demo_observed_values.html">demo_observed_values</a></span>,
              <span class="st">"MEAN.AIR.TEMP"</span> <span class="op">=</span> <span class="va">predictions</span><span class="op">$</span><span class="va">MEAN.AIR.TEMP</span>,
             <span class="st">"AIR.TEMP.RANGE"</span> <span class="op">=</span> <span class="va">predictions</span><span class="op">$</span><span class="va">AIR.TEMP.RANGE</span><span class="op">)</span></code></pre></div>
</div>
<div id="temperature-increments" class="section level3">
<h3 class="hasAnchor">
<a href="#temperature-increments" class="anchor"></a>Temperature Increments</h3>
<p>We can now use the reference temperature values as a baseline and slowly increase the temperature.</p>
<p>To do this, we create a list for increasing temperatures simulating a 0-2 degree rise in temperature with 0.2 increments.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">temperature_increments</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0.2</span><span class="op">)</span>
<span class="va">temperature_increments</span></code></pre></div>
<pre><code>##  [1] 0.0 0.2 0.4 0.6 0.8 1.0 1.2 1.4 1.6 1.8 2.0</code></pre>
</div>
<div id="simulate-temperature-increase" class="section level3">
<h3 class="hasAnchor">
<a href="#simulate-temperature-increase" class="anchor"></a>Simulate Temperature Increase</h3>
<p>Here’s the big function: Loop through temperature increases and run classification and predictions for each temperature increment.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>modelled_temperatures <span class="ot">&lt;-</span> <span class="fu">map_df</span>(temperature_increments, <span class="cf">function</span>(increment){</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  demo_observed_values<span class="sc">$</span>MEAN.AIR.TEMP <span class="ot">&lt;-</span> demo_observed_values<span class="sc">$</span>MEAN.AIR.TEMP <span class="sc">+</span> increment</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  demo_observed_values<span class="sc">$</span>AIR.TEMP.RANGE <span class="ot">&lt;-</span> demo_observed_values<span class="sc">$</span>AIR.TEMP.RANGE <span class="sc">+</span> increment</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  predict_modelled <span class="ot">&lt;-</span> <span class="fu">rict_predict</span>(demo_observed_values)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  classify_modelled <span class="ot">&lt;-</span> <span class="fu">rict_classify</span>(predict_modelled, <span class="at">year_type =</span> <span class="st">"single"</span>)<span class="dv">0</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  modelled <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(predict_modelled, classify_modelled, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"SITE"</span>, <span class="st">"YEAR"</span>, <span class="st">"WATERBODY"</span>))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add temperature increase column so we know which results match which temperature increment</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  modelled<span class="sc">$</span>TEMP.INCREASE <span class="ot">&lt;-</span> increment </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  modelled<span class="sc">$</span>SITE  <span class="ot">&lt;-</span> <span class="fu">as.character</span>(modelled<span class="sc">$</span>SITE)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(modelled)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter on one year - to make results easier to display</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>modelled_data <span class="ot">&lt;-</span> modelled_temperatures <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(YEAR <span class="sc">==</span> <span class="dv">2016</span>)</span></code></pre></div>
<p>The <code>map_df</code> function from the <code>tidyverse</code> package, iterates over the <code>temperature_increments</code> values and runs a function to return results for each <code>increment</code>. For each loop/iteration the function will:</p>
<ul>
<li>Updates the temperature values by adding the <code>increment</code>
</li>
<li>Run the <code>rict_predict</code> and <code>rict_classify</code> functions</li>
<li>Join the prediction and classification outputs together using <code>inner_join</code>
</li>
<li>Returns the <code>modelled</code> results in a dataframe</li>
</ul>
<p>For a deep-dive into iteration/loops and <code>map_df</code> type functions, see this <a href="https://r4ds.had.co.nz/iteration.html">guide</a>.</p>
</div>
<div id="results" class="section level3">
<h3 class="hasAnchor">
<a href="#results" class="anchor"></a>Results</h3>
<p>Now we have the classification and predictions in a single dataframe, we can review the results of our temperature simulation. We can plot the average ASPT Spring and Autumn classification EQRs (<code>ASPT_aver_spr_aut</code>) by each temperature increase. Note, the higher the EQR value the ‘better’ the ecological status of the site.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">modelled_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">TEMP.INCREASE</span>, y  <span class="op">=</span> <span class="va">ASPT_aver_spr_aut</span>, color <span class="op">=</span> <span class="va">SITE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="tech-demo-temperature-change_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>We can see the EQRs have a mixed response to increasing temperature. Note, you can find more about <code>ggplot</code> functions and creating plots with data in this <a href="https://ggplot2.tidyverse.org/">guide</a>.</p>
</div>
<div id="confidence-in-simulation" class="section level3">
<h3 class="hasAnchor">
<a href="#confidence-in-simulation" class="anchor"></a>Confidence in Simulation</h3>
<p>Can we really expect increasing temperature to affect EQRs in this way? Are these simulated temperature increases beyond the scope of the model and training data used to build the model? One way to provide a partial answer this question, is to use the suitability code (<code>suitcode</code>) provided in the predictions outputs. The suitability code indicates if the input data is significantly different from the data used to train the model (and therefore we are less confident it can make accurate predictions). It assesses this on a scale between 1-5, 1 - Low difference, 5 - High difference.</p>
<p>Here we select the suitability code and temperature increment to see how the confidence in the input data suitability changes as temperature increases:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">select</span><span class="op">(</span><span class="va">modelled_data</span>, <span class="va">SITE</span>, <span class="va">TEMP.INCREASE</span>, <span class="va">SuitCode</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">arrange</span><span class="op">(</span><span class="va">TEMP.INCREASE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">32</span><span class="op">)</span> <span class="co"># return the first 32 rows only</span></code></pre></div>
<pre><code>##           SITE TEMP.INCREASE SuitCode
## 1  MYR-GB-01-R           0.0        1
## 2  MYR-GB-05-R           0.0        1
## 3  MYR-GB-09-R           0.0        1
## 4  MYR-GB-12-R           0.0        2
## 5  MYR-GB-01-D           0.0        1
## 6  MYR-GB-05-D           0.0        1
## 7  MYR-GB-09-D           0.0        1
## 8  MYR-GB-12-D           0.0        2
## 9  MYR-GB-01-R           0.2        1
## 10 MYR-GB-05-R           0.2        1
## 11 MYR-GB-09-R           0.2        1
## 12 MYR-GB-12-R           0.2        4
## 13 MYR-GB-01-D           0.2        1
## 14 MYR-GB-05-D           0.2        1
## 15 MYR-GB-09-D           0.2        1
## 16 MYR-GB-12-D           0.2        4
## 17 MYR-GB-01-R           0.4        4
## 18 MYR-GB-05-R           0.4        3
## 19 MYR-GB-09-R           0.4        3
## 20 MYR-GB-12-R           0.4        5
## 21 MYR-GB-01-D           0.4        4
## 22 MYR-GB-05-D           0.4        3
## 23 MYR-GB-09-D           0.4        3
## 24 MYR-GB-12-D           0.4        5
## 25 MYR-GB-01-R           0.6        5
## 26 MYR-GB-05-R           0.6        5
## 27 MYR-GB-09-R           0.6        5
## 28 MYR-GB-12-R           0.6        5
## 29 MYR-GB-01-D           0.6        5
## 30 MYR-GB-05-D           0.6        5
## 31 MYR-GB-09-D           0.6        5
## 32 MYR-GB-12-D           0.6        5</code></pre>
<p>We can see the suitability code indicates the input data is increasing <em>unsuitable</em> as the temperature increases beyond 0.2 degrees. It appears we may be extrapolating beyond what the training data can reasonably allow. Therefore, there is low confidence in this simulation.</p>
</div>
<div id="summary" class="section level3">
<h3 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h3>
<p>Although this example has no conclusive results, hopefully it shows how input data can be simulated to predict different scenarios. For instance, we could run a similar analysis to investigate the impact of changes to other predictive variables such as discharge.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Maybin Muyeba, Tim Foster, Tim Loveday.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
